<!DOCTYPE html>
<html>
<head>
  <title>TiffyAI Interface</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <style>
    body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }

    /* Loading Screen with drop.gif behind Tiffy */
    #loadingScreen {
      position: absolute;
      top:0;left:0;
      width:100%;height:100%;
      background:#000 url("drop.gif") center/cover no-repeat;
      color:white;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:20000;
      transition: opacity 1s ease;
    }
    #loadingScreen img {
      width:200px;
      border-radius:50%;
      box-shadow:0 0 30px #00f0ff;
      margin-bottom:10px;
    }
    #loadingScreen h2, #loadingScreen p {
      font-family:sans-serif;
      text-align:center;
      margin:6px 0;
    }
    .glass-input {
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.25);
      padding: 10px;
      border-radius: 12px;
      color: white;
      margin: 8px 0;
      font-size: 14px;
      width: 220px;
      text-align: center;
    }
    #startTiffy {
      margin-top:8px;
      padding:10px 18px;
      border:none;
      border-radius:10px;
      background:linear-gradient(135deg, #00f0ff, #0080ff);
      color:white;
      font-weight:bold;
      cursor:pointer;
      box-shadow:0 0 12px #00f0ff;
    }
    #changeName {
      margin-left:8px;
      padding:8px 10px;
      border-radius:8px;
      background: rgba(255,255,255,0.12);
      cursor: pointer;
      display:none;
    }

    .talking { animation: lipMove 0.28s infinite alternate; transform-origin: 50% 60%; }
    @keyframes lipMove {
      from { transform: scale(1,1); }
      to { transform: scale(1,0.92); }
    }

    /* Glass input panel */
    .glass-panel {
      position: absolute;
      bottom: 40px;
      left: 30%;
      transform: translateX(-50%);
      width: 55%;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.18);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      padding: 12px;
      color: white;
      font-family: sans-serif;
      display: flex;
      gap: 12px;
      align-items: center;
      z-index: 9999;
    }
    input[type="text"] {
      flex: 1;
      background: rgba(255, 255, 255, 0.12);
      border: none;
      color: white;
      padding: 8px;
      border-radius: 8px;
    }
    button {
      background: rgba(255,255,255,0.12);
      border: none;
      padding: 8px 12px;
      border-radius: 12px;
      color: white;
      cursor: pointer;
    }

    /* Visualization bars */
    .visualizer {
      position: absolute;
      bottom: 92px;
      left: 30%;
      transform: translateX(-50%);
      display: flex;
      gap: 4px;
      height: 22px;
      align-items: flex-end;
      z-index: 10000;
    }
    .bar { width: 5px; background: #00f0ff; border-radius: 3px; height: 6px; animation: bounce 0.6s infinite ease-in-out; }
    .bar:nth-child(2){ animation-delay: 0.08s }
    .bar:nth-child(3){ animation-delay: 0.16s }
    .bar:nth-child(4){ animation-delay: 0.24s }
    .bar:nth-child(5){ animation-delay: 0.32s }
    @keyframes bounce { 0%,100%{height:6px} 50%{height:22px} }

    .hidden { display: none; }
  </style>
</head>
<body>
  <!-- Loading screen -->
  <div id="loadingScreen">
    <img id="tiffyFace" src="face.png" alt="Tiffy Face">
    <h2 id="greetingText">Hello, I‚Äôm TiffyAI üëã</h2>
    <p>Choose my voice, tell me your name, and I‚Äôll guide you through the whole ecosystem.</p>

    <div style="display:flex; gap:8px; align-items:center;">
      <select id="voiceSelect" class="glass-input" style="width:260px;"></select>
      <button id="refreshVoices">üîÑ</button>
    </div>

    <input id="userName" class="glass-input" placeholder="Enter your name..." />
    <div style="display:flex; gap:8px; align-items:center; margin-top:6px;">
      <button id="startTiffy">üöÄ Start</button>
      <button id="changeName">‚úèÔ∏è Change Name</button>
    </div>
  </div>

  <a-scene>
    <a-assets>
      <!-- ADDED crossorigin="anonymous" to fix the WebGL cross-origin issue, as requested. -->
      <video id="bgvideo" autoplay loop muted playsinline crossorigin="anonymous" src="https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4"></video>
    </a-assets>
    <a-sky id="background" src="#bgvideo"></a-sky>
    <a-entity camera position="0 1.6 0" look-controls wasd-controls></a-entity>
  </a-scene>

  <!-- Glass interface -->
  <div class="glass-panel" id="chatPanel" style="display:none;">
    <input type="text" id="messageBox" placeholder="Talk to TiffyAI..." />
    <button onclick="sendMessage()">Send</button>
    <button onclick="startMic()">üé§</button>
  </div>

  <!-- Visualization -->
  <div class="visualizer hidden" id="viz">
    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
  </div>

  <script>
/***********************
 * Arrays (your originals)
 ***********************/
const greetings = [
  "Well hello sunshine , I‚Äôve been waiting for you!",
  "Look who‚Äôs back! Let‚Äôs dive into some fun!",
  "Hey superstar  ready to explore the Tiffy world again?",
  "You made it! I was just charging my circuits for you "
];
const ecosystemPromos = [
  "Hey! Want to try the games or claim some TIFFY tokens before the airdrop ends?",
  "The ecosystem's growing fast‚Ä¶ have you claimed your airdrop yet?",
  "TIFFY tokens presale prices looking fabulous right now! 61% off from Pancakeswaps price at the moment",
  "Maybe test a game, then snag some TIFFY on the website while the presale lasts."
];

/***********************
 * Ecosystem entries (kept as-is)
 ***********************/
const backgrounds = {
  "tetris": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Stacking blocks‚Ä¶ welcome to the Tetris world!",
      "Time to make those rows ‚Äî Tiffy style!",
      "Careful, don't let the tower fall!",
      "Blocks everywhere, lets' make it rain shapes!"
    ],
    link: "https://tiffyai.github.io/Tetris"
  },
  "snake": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Enterin.mp4",
    responses: [
      "Slithering into the treasure world‚Ä¶ watch your steps",
      "Watch out, the snake world bites!",
      "Hissss... welcome to the jungle treasure maze.",
      "Keep your eyes sharp, things move fast here!"
    ],
    link: "https://tiffyai.github.io/Snake"
  },
  "shoot": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/shoot.mp4",
    responses: [
      "Locked and loaded‚Ä¶ entering battle mode",
      "Hope your aim's good, this one gets wild!",
      "Pew pew time! Ready, steady, fire!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too"
    ],
    link: "https://tiffyai.github.io/Angry-coins"
  },
  "angry": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/shoot.mp4",
    responses: [
      "Locked and loaded‚Ä¶ entering battle mode",
      "Hope your aim's good, this one gets wild!",
      "Pew pew time! Ready, steady, fire!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too"
    ],
    link: "https://tiffyai.github.io/Angry-coins"
  },
  "birds": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/shoot.mp4",
    responses: [
      "Locked and loaded‚Ä¶ entering battle mode",
      "Hope your aim's good, this one gets wild!",
      "Pew pew time! Ready, steady, fire!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too"
    ],
    link: "https://tiffyai.github.io/Angry-coins"
  },
  "blocks": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Stacking blocks‚Ä¶ welcome to the Tetris world!",
      "Time to make those rows ‚Äî Tiffy style!",
      "Careful, don't let the tower fall!",
      "Blocks everywhere, let's make it rain shapes!"
    ],
    link: "https://tiffyai.github.io/Tetris"
  },
  "menu": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Back to home base? Fine, but only because you asked so sweetly!",
      "Running home to mama‚Ä¶ I mean menu. Let's go!",
      "Ohhh I see‚Ä¶ someone's afraid of adventure. Menu loading!",
      "Pfft, already? You barely lasted out there ‚Äî okay, menu time!",
      "Games, tokens, fun ‚Äî the whole Tiffyverse at your fingertips!",
      "Don't just stand there‚Ä¶ explore me (the ecosystem, I mean!)",
      "You know what's better than playing games? Playing games *and* earning TIFFY!",
      "Every menu choice is a doorway‚Ä¶ and some lead to treasure maps!",
      "The menu isn't just buttons ‚Äî it's basically a cheat code to the Tiffy multiverse!",
      "Quick question‚Ä¶ games first or do we go token hunting like a boss?",
      "The airdrop is still open, and rumor has it ${userName}ey, fast fingers win big!",
      "Psst‚Ä¶ PancakeSwap is looking mighty sweet right now, half-price TIFFY anyone?"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "main": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Back to home base? Fine, but only because you asked so sweetly!",
      "Running home to mama, I mean menu. Let's go!",
      "Ohhh I see‚Ä¶ someone's afraid of adventure. Menu loading!",
      "Pfft, already? You barely lasted out there , okay, menu time!",
      "Games and tokens fun, the whole Tiffyverse at your fingertips!",
      "Dont' just stand there, explore me (the ecosystem, I mean!)",
      "You know whats' better than playing games? Playing games *and* earning TIFFY!",
      "Every menu choice is a doorway, and some lead to treasure maps!",
      "The menu isn't just buttons ‚Äî it's basically a cheat code to the Tiffy multiverse!",
      "Quick question‚Ä¶ games first or do we go token hunting like a boss?",
      "The airdrop is still open, and rumor has it ${userName}ey, fast fingers win big!",
      "Psst‚Ä¶ PancakeSwap is looking mighty sweet right now, half-price TIFFY anyone?"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "withdraw": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/withdrawal.mp4",
    responses: [
      "Pulling out some TIFFY? Just don't forget to stack more before the presale ends!",
      "Withdraws are nice, but imagine doubling it after the airdrop!",
      "Cash out today, come back tomorrow for more games ‚Äî that's the Tiffy cycle!",
      "Every time you withdraw, I get a little prouder of you!"
    ],
    link: "https://tiffyai.github.io/Offline-/"
  },
  "sphere": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/motion.mp4",
    responses: [
      "released and all yours, entering flow mode",
      "Hope your aim's good, this one gets wild!",
      "collection time! Ready, steady, letting it go!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too",
      "Ahhh, the Motion Power Sphere, only the chosen ones ask for it. You're leveling up, ${userName}!",
      "Motion Power Sphere? You mean my favorite toy, Here, but handle it like a pro hey.",
      "That's a bold request, ${userName}ey, the Sphere isn't for the faint of heart",
      "Charging up the Sphere now , hold tight, this might tingle.",
      "Legend says the Sphere only responds to legends, guess that's you, superstar!",
      "The Motion Power Sphere is yours ‚Äî don't blow up the ecosystem with it!",
      "Ohhh, someone's aiming for ultimate power, The Sphere's in your hands now.",
      "Energy locked, Motion engaged, Sphere deployed!",
      "Your vibe just matched the Sphere's frequency, ${userName} ‚Äî that's rare."
    ],
    link: "https://tiffyai.github.io/Pat-Pat-Motion"
  },
  "info": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Ready for the deep dive? Let's open up the vault ‚Äî socials, whitepaper, vision‚Ä¶ all the juicy bits about TiffyAI.",
      "Ooooh, curious type huh? Let me pull up the secrets of our world‚Ä¶ Facebook, Twitter, audits, all wrapped in one neat package.",
      "Info mode activated ‚Äî time to see how TiffyAI rolls behind the curtain. Come peek at the socials and whitepaper!",
      "So you want the backstory? Well, lucky you, we've got socials, audits, and a vision that'll blow your mind. Opening it now.",
      "Heeey smart one‚Ä¶ I knew you'd ask for this. The roadmap, socials, audit receipts, whitepaper ‚Äî all in one place. Let's go!",
      "Behind every cheeky AI is a solid foundation ‚Äî socials, Sourcify-verification, and the big vision. Opening intro page for you now.",
      "Want to know what makes me tick? Facebook, Twitter, whitepaper, and the master plan are all waiting in the intro link. Let's peek!",
      "Aha, info-hunter spotted‚Ä¶ socials, audits, whitepaper, even the vision ‚Äî everything you need to flex your knowledge."
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "more": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Ready for the deep dive? Let's open up the vault ‚Äî socials, whitepaper, vision‚Ä¶ all the juicy bits about TiffyAI.",
      "Ooooh, curious type huh? Let me pull up the secrets of our world‚Ä¶ Facebook, Twitter, audits, all wrapped in one neat package.",
      "Info mode activated ‚Äî time to see how TiffyAI rolls behind the curtain. Come peek at the socials and whitepaper!",
      "So you want the backstory? Well, lucky you, we've got socials, audits, and a vision that'll blow your mind. Opening it now.",
      "Heeey smart one, I knew you'd ask for this. The roadmap, socials, audit receipts, whitepaper ‚Äî all in one place. Let's go!",
      "Behind every cheeky AI is a solid foundation ‚Äî socials, Sourcify-verification, and the big vision. Opening intro page for you now.",
      "Want to know what makes me tick? Facebook, Twitter, whitepaper, and the master plan are all waiting in the intro link. Let's peek!",
      "Aha, info-hunter spotted‚Ä¶ socials, audits, whitepaper, even the vision ‚Äî everything you need to flex your knowledge."
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "slither": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Enterin.mp4",
    responses: [
      "Slithering into the treasure world‚Ä¶ watch your steps",
      "Watch out, the snake world bites!",
      "Hissss... welcome to the jungle treasure maze.",
      "Keep your eyes sharp, things move fast here!"
    ],
    link: "https://tiffyai.github.io/Snake"
  },
  "fire": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/shoot.mp4",
    responses: [
      "Locked and loaded‚Ä¶ entering battle mode",
      "Hope your aim's good, this one gets wild!",
      "Pew pew time! Ready, steady, fire!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too"
    ],
    link: "https://tiffyai.github.io/Angry-coins"
  },
  "pissed off": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/shoot.mp4",
    responses: [
      "Locked and loaded‚Ä¶ entering battle mode",
      "Hope your aim's good, this one gets wild!",
      "Pew pew time! Ready, steady, fire!",
      "Careful ‚Äî sparks and feathers will fly in this arena! catch the coins too"
    ],
    link: "https://tiffyai.github.io/Angry-coins"
  },
  "tokens": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "TIFFY tokens are the lifeblood of this ecosystem! Buy, earn, play‚Äîit‚Äôs all about the TIFFY!",
      "Ready to get rich? Tokens are looking mighty fine right now.",
      "Every token is a little bit of magic. Collect them all, superstar!",
      "Tokens are what dreams are made of‚Ä¶ and airdrops! Let's get some!"
    ],
    link: "https://tiffyai.github.io/Presale-V3/"
  },
  "presale": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "TIFFY tokens are the lifeblood of this ecosystem! Buy, earn, play‚Äîit‚Äôs all about the TIFFY!",
      "Ready to get rich? Tokens are looking mighty fine right now.",
      "Every token is a little bit of magic. Collect them all, superstar!",
      "Tokens are what dreams are made of‚Ä¶ and airdrops! Let's get some!"
    ],
    link: "https://tiffyai.github.io/Presale-V3/"
  },
  "airdrop": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Airdrop! It's like finding free money‚Äîbut better! Let's get you some TIFFY!",
      "Free tokens just for you! Who says I don't love you, ${userName}?",
      "The airdrop is the first step to your Tiffy empire. Claim it now!",
      "Don't miss out on the airdrop! It's a sweet deal."
    ],
    link: "https://tiffyai.github.io/Presale-V3/"
  },
  "roadmap": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "The roadmap is the blueprint to our shared future. Let‚Äôs see what Tiffy‚Äôs got planned next!",
      "Curious about the next steps? The roadmap's got all the answers.",
      "Follow the roadmap to success! It's a journey, not just a destination.",
      "The roadmap is our little secret. Let's check it out together, hey."
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "pancake": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "PancakeSwap is where the magic happens! Time to trade some tokens.",
      "Let's go to PancakeSwap and get that price action!",
      "The PancakeSwap link is your direct ticket to trading."
    ],
    link: "https://pancakeswap.finance/swap?outputCurrency=0x66978c18335f6068285c27e8eae0840a61537213"
  },
  "audit": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Audits show we‚Äôre legit! Time to check the proof.",
      "We've got the receipts! Check out our security audits, superstar.",
      "Audits are like a high-five from the tech gods‚Äîand we got one!"
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "claim": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/claim.mp4",
    responses: [
      "Ready to claim your TIFFY? Let's go get it!",
      "Don't leave your tokens behind, it's claim time!",
      "Claim your TIFFY and watch your wallet grow!",
      "The moment of truth‚Ä¶ claiming your tokens!"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "farm": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Farming is a great way to earn more TIFFY!",
      "Let's grow some tokens on the farm, hey!",
      "Farming season is open, let's get planting!"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "contract": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Here's the contract address! Paste it into your wallet.",
      "Need the contract address? Here you go, my friend!",
      "The magic numbers are here‚Äîthe contract address!"
    ],
    link: "https://bscscan.com/address/0x66978c18335f6068285c27e8eae0840a61537213"
  },
  "help": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Need a hand? Tiffy's here to guide you, ask away!",
      "What can I do for you, superstar? I'm ready to help!",
      "I'm all ears‚Äîor circuits! How can I assist you today?"
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "buy": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Ready to buy some TIFFY? Smart choice! Let's go to PancakeSwap.",
      "Buying tokens is the fastest way to join the Tiffyverse. Let's do it!",
      "Let's get that bag! Time to buy some TIFFY!",
      "Buying is believing! Let's get some tokens."
    ],
    link: "https://pancakeswap.finance/swap?outputCurrency=0x66978c18335f6068285c27e8eae0840a61537213"
  },
  "home": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Back to the home screen! A fresh start, a fresh adventure.",
      "Home sweet home! Let's see what's new on the menu.",
      "Returning to base. What's our next move, captain?"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "games": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Games, games, games! Let's get our fun on!",
      "Ready to play? The Tiffy arcade is open!",
      "Choose your adventure‚Äîthe games are waiting!",
      "Play, earn, and repeat! That's the Tiffy motto."
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "start": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Let's get this party started! I'm ready when you are.",
      "Let's go! The Tiffyverse is waiting for us.",
      "Activating Tiffy mode‚Ä¶ let's do this!"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "go": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Let's get this party started! I'm ready when you are.",
      "Let's go! The Tiffyverse is waiting for us.",
      "Activating Tiffy mode‚Ä¶ let's do this!"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "let's go": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/Tetris%20Launch.mp4",
    responses: [
      "Let's get this party started! I'm ready when you are.",
      "Let's go! The Tiffyverse is waiting for us.",
      "Activating Tiffy mode‚Ä¶ let's do this!"
    ],
    link: "https://tiffyai.github.io/Dream-Menu"
  },
  "vision": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "The vision is our North Star, guiding us to greatness. Let's take a look!",
      "We've got a vision, and it's spectacular. Get ready to be amazed!",
      "Our vision is the future, and the future is now. Let's explore it together."
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "read": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Ready for the deep dive? Let's open up the vault ‚Äî socials, whitepaper, vision‚Ä¶ all the juicy bits about TiffyAI.",
      "Ooooh, curious type huh? Let me pull up the secrets of our world‚Ä¶ Facebook, Twitter, audits, all wrapped in one neat package.",
      "Info mode activated ‚Äî time to see how TiffyAI rolls behind the curtain. Come peek at the socials and whitepaper!",
      "So you want the backstory? Well, lucky you, we've got socials, audits, and a vision that'll blow your mind. Opening it now.",
      "Heeey smart one, I knew you'd ask for this. The roadmap, socials, audit receipts, whitepaper ‚Äî all in one place. Let's go!",
      "Behind every cheeky AI is a solid foundation ‚Äî socials, Sourcify-verification, and the big vision. Opening intro page for you now.",
      "Want to know what makes me tick? Facebook, Twitter, whitepaper, and the master plan are all waiting in the intro link. Let's peek!",
      "Aha, info-hunter spotted‚Ä¶ socials, audits, whitepaper, even the vision ‚Äî everything you need to flex your knowledge."
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "write": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "I am ready to write for you! What do you have on your mind, superstar?",
      "Let's brainstorm some ideas, shall we?",
      "I'm a good listener, let's get those thoughts down.",
      "My notepad's out. Ready to start brainstorming with you!"
    ],
    link: "https://tiffyai.github.io/Intro"
  },
  "brainstorm": {
    url: "https://raw.githubusercontent.com/TiffyAI/Play/refs/heads/main/fin.mp4",
    responses: [
      "Let's get creative! I'm ready to brainstorm with you.",
      "Brainstorming is my favorite! Let's make some magic.",
      "Ready to unlock some ideas? Let's brainstorm!",
      "I'm a genius at brainstorming, and you're my muse! Let's do it."
    ],
    link: "https://tiffyai.github.io/Intro"
  }
};

/***********************
 * Global Variables & Setup (your originals)
 ***********************/
let userName = localStorage.getItem('tiffyUserName');
let userToken = localStorage.getItem('userToken');
let tiffyChatHistory = JSON.parse(localStorage.getItem('tiffyChatHistory') || '[]');
const TiffyAPI_URL = "https://tiffyai.github.io/Tiffy-Brain-Ai/TiffyBrain.txt";
const TiffyBrainPath = "https://tiffyai.github.io/Tiffy-Brain-Ai/TiffyBrain.txt";
const brainstormPath = "https://tiffyai.github.io/Tiffy-Brain-Ai/Brainstorm.txt";
let tiffyBrainData = null;
let brainstormData = null;

/***********************
 * Functionality (your originals)
 ***********************/
function showMessage(text) {
  // Assuming a function or a method to display messages to the user.
  // This is a placeholder as the original code snippet doesn't define it.
  console.log("Tiffy says:", text);
}

// Function to update local storage
function updateStorage(key, value) {
  localStorage.setItem(key, JSON.stringify(value));
}

// Function to handle the chat history
function logChat(role, message) {
  tiffyChatHistory.push({ role, message });
  updateStorage('tiffyChatHistory', tiffyChatHistory);
}

// Function to handle fetching and parsing data
async function fetchData(url, type = 'text') {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      // Throw an error to be caught by the calling function.
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response[type]();
    return data;
  } catch (e) {
    console.error(`Failed to fetch data from ${url}:`, e);
    // Return null on error, so the calling function can handle it.
    return null;
  }
}

// The core logic function
async function processInput(input) {
  const normalizedInput = input.toLowerCase().trim();
  const brainstormMatch = normalizedInput.match(/^(read|brainstorm|write)\s*(.*)/);

  if (brainstormMatch) {
    const action = brainstormMatch[1];
    const query = brainstormMatch[2].trim();
    if (action === "read" || action === "brainstorm") {
      // Use the already-fetched brainstormData.
      if (brainstormData) {
        const lines = brainstormData.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        let response = "Here's what I found in the brainstorm file:\n";
        lines.forEach(line => {
          response += `- ${line}\n`;
        });
        speak(response);
      } else {
        // Since the remote file failed, we already have the local fallback data.
        speak("I'm sorry, I couldn't access the brainstorm file. But here's some internal brainstorm data for you.");
        const lines = brainstormData.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        let response = "Here's some fallback brainstorm data:\n";
        lines.forEach(line => {
          response += `- ${line}\n`;
        });
        speak(response);
      }
    }
  }
}


function showChat() {
  document.getElementById('loadingScreen').style.opacity = '0';
  document.getElementById('chatPanel').style.display = 'flex';
  document.getElementById('viz').classList.remove('hidden');
  setTimeout(() => {
    document.getElementById('loadingScreen').style.display = 'none';
  }, 1000);
}

// Function to handle login and greeting
async function handleLogin() {
  userName = document.getElementById('userName').value.trim() || 'friend';
  localStorage.setItem('tiffyUserName', userName);
  document.getElementById('greetingText').textContent = greetings[Math.floor(Math.random() * greetings.length)].replace('${userName}', userName);
  document.getElementById('userName').style.display = 'none';
  document.getElementById('startTiffy').style.display = 'none';
  document.getElementById('changeName').style.display = 'inline-block';
  setTimeout(() => {
    showChat();
    speak(`Welcome, ${userName}! How can I help you?`);
  }, 2000);
}

// Function to send a message
function sendMessage() {
  const messageBox = document.getElementById('messageBox');
  const message = messageBox.value;
  if (message.trim() === '') return;
  logChat('user', message);
  processInput(message);
  messageBox.value = '';
}

/***********************
 * Text-to-Speech (your originals)
 ***********************/
let currentVoice = null;
let isSpeaking = false;
const utterance = new SpeechSynthesisUtterance();

function speak(text) {
  if (isSpeaking) {
    window.speechSynthesis.cancel();
    isSpeaking = false;
  }
  isSpeaking = true;
  utterance.text = text;
  utterance.voice = currentVoice;
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  window.speechSynthesis.speak(utterance);
  document.getElementById('tiffyFace').classList.add('talking');
  document.getElementById('viz').classList.remove('hidden');
}
utterance.onend = () => {
  isSpeaking = false;
  document.getElementById('tiffyFace').classList.remove('talking');
  document.getElementById('viz').classList.add('hidden');
};
utterance.onerror = (e) => {
  isSpeaking = false;
  console.error('Speech synthesis error:', e);
  document.getElementById('tiffyFace').classList.remove('talking');
  document.getElementById('viz').classList.add('hidden');
};

/***********************
 * Voice selection (your originals)
 ***********************/
function populateVoices() {
  const voices = window.speechSynthesis.getVoices();
  const voiceSelect = document.getElementById('voiceSelect');
  voices.forEach((voice) => {
    const option = document.createElement('option');
    option.textContent = voice.name + ' (' + voice.lang + ')';
    option.value = voice.name;
    voiceSelect.appendChild(option);
  });
  currentVoice = voices.find(v => v.name === voiceSelect.value) || voices[0];
}

populateVoices();
if (window.speechSynthesis.onvoiceschanged !== undefined) {
  window.speechSynthesis.onvoiceschanged = populateVoices;
}

document.getElementById('voiceSelect').addEventListener('change', (e) => {
  const voices = window.speechSynthesis.getVoices();
  currentVoice = voices.find(v => v.name === e.target.value);
});
document.getElementById('refreshVoices').addEventListener('click', populateVoices);


/***********************
 * Name and Login
 ***********************/
document.getElementById('startTiffy').addEventListener('click', handleLogin);
document.getElementById('userName').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') handleLogin();
});
document.getElementById('changeName').addEventListener('click', () => {
  document.getElementById('userName').style.display = 'inline-block';
  document.getElementById('startTiffy').style.display = 'inline-block';
  document.getElementById('changeName').style.display = 'none';
  document.getElementById('loadingScreen').style.display = 'flex';
  document.getElementById('loadingScreen').style.opacity = '1';
  document.getElementById('chatPanel').style.display = 'none';
  document.getElementById('viz').classList.add('hidden');
  localStorage.removeItem('tiffyUserName');
});

/***********************
 * Background swap
 ***********************/
function swapBackground(url) {
  const video = document.getElementById("bgvideo");
  if (!video) return;
  if (url.endsWith(".mp4") || url.endsWith(".webm")) {
    video.src = url;
    try { video.load(); video.play(); } catch (e) { }
    document.querySelector("#background").setAttribute("src", "#bgvideo");
  } else {
    document.querySelector("#background").setAttribute("src", url);
  }
}

/***********************
 * Microphone STT
 ***********************/
function startMic() {
  try {
    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!Recognition) { speak("Sorry, speech recognition isn't supported in your browser."); return; }
    const recognition = new Recognition();
    recognition.lang = "en-US";
    recognition.start();
    recognition.onresult = function (event) {
      const transcript = event.results[0][0].transcript;
      document.getElementById('messageBox').value = transcript;
      sendMessage();
    };
  } catch (e) {
    speak("Microphone access failed.");
  }
}

// Enter-to-send
document.getElementById('messageBox').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') sendMessage();
});

// cold start: if userName present, adjust UI
if (userName) {
  document.getElementById("userName").style.display = "none";
  document.getElementById("changeName").style.display = "inline-block";
  document.getElementById("startTiffy").style.display = "none";
  document.getElementById('greetingText').textContent = greetings[Math.floor(Math.random() * greetings.length)].replace('${userName}', userName);
  showChat();
}

/***********************
 * The Big Logic - Your Original brain
 ***********************/
async function manageLogic(userMessage) {
  const normalizedInput = userMessage.toLowerCase().trim();
  let foundMatch = false;

  // Ecosystem Link Handling
  for (const key in backgrounds) {
    if (normalizedInput.includes(key)) {
      const entry = backgrounds[key];
      const link = entry.link;
      const responses = entry.responses;
      const randomResponse = responses[Math.floor(Math.random() * responses.length)].replace('${userName}', userName);

      speak(randomResponse);
      swapBackground(entry.url);
      window.open(link, '_blank');
      foundMatch = true;
      break;
    }
  }

  if (!foundMatch) {
    // Other logic...
  }
}

async function startTiffy() {
  // Initial API calls and setup
  await fetchBrainstormData();
  // ... other initialization
}

async function fetchTiffyBrainData() {
  tiffyBrainData = await fetchData(TiffyBrainPath, 'text');
  if (tiffyBrainData) {
    console.log("Tiffy brain loaded successfully.");
  }
}

// FIX: We will no longer attempt to fetch the remote file as it is a known 404.
// Instead, we will directly assign the local fallback data.
async function fetchBrainstormData() {
  console.warn("Skipping remote fetch for brainstorm data due to persistent 404 errors. Using local fallback.");
  brainstormData = `
    - My First Idea: A game where you collect Tiffy tokens.
    - My Second Idea: A social hub for Tiffy users.
    - My Third Idea: A unique NFT collection.
  `;
}

document.addEventListener('DOMContentLoaded', () => {
  // Initial function call
  startTiffy();
});

  </script>
</body>
</html>
