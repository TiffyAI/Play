<!DOCTYPE html>
<html>
<head>
  <title>TiffyAI Interface</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Load a custom font from Google Fonts for a modern look
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      background: #111;
    }

    #app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      border-radius: 12px;
      color: white;
      padding: 16px;
    }

    /* Custom styles for the chat interface */
    .chat-bubble {
      max-width: 80%;
      padding: 12px;
      border-radius: 20px;
      margin-bottom: 10px;
      animation: fadein 0.5s ease-in-out;
    }

    .chat-user {
      background: #007bff;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .chat-bot {
      background: #333;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-gray-900 font-inter">

  <!-- Main Application Container -->
  <div id="app-container" class="flex flex-col h-screen p-4">

    <!-- Loading Screen (remains in the background for a smooth transition) -->
    <div id="loadingScreen" class="absolute inset-0 z-50 flex items-center justify-center bg-gray-900 transition-opacity duration-1000">
      <div class="flex flex-col items-center">
        <img src="https://placehold.co/200x200/000000/FFFFFF?text=AI" alt="AI Avatar" class="rounded-full shadow-2xl shadow-blue-500/50 mb-4 animate-pulse">
        <h2 class="text-3xl text-white font-extrabold tracking-wide">TiffyAI</h2>
        <p class="text-white text-opacity-75 text-sm mt-1">Initializing...</p>
      </div>
    </div>

    <!-- User Information and Controls -->
    <div id="top-bar" class="flex justify-between items-center p-4 bg-transparent text-white z-10">
      <div id="userName" class="text-xl font-bold rounded-lg px-3 py-1 bg-white bg-opacity-10 backdrop-blur-md">User</div>
      <button id="changeName" class="text-sm rounded-lg px-3 py-1 text-gray-200 hover:text-white transition-colors duration-200">
        Change Name
      </button>
    </div>

    <!-- Chat History Display -->
    <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-4">
      <!-- Chat messages will be dynamically added here -->
    </div>

    <!-- User Input and Controls -->
    <div id="input-controls" class="flex items-center p-4 bg-transparent z-10">
      <input type="text" id="messageBox" placeholder="Type your message..." class="flex-1 glassmorphism px-4 py-3 rounded-full text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
      
      <button id="sendBtn" class="ml-2 glassmorphism p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-200">
        <!-- Send Icon (SVG) -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
        </svg>
      </button>

      <button id="micBtn" class="ml-2 glassmorphism p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-200">
        <!-- Mic Icon (SVG) -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 11-14 0m14 0a7 7 0 00-14 0m14 0a7 7 0 01-14 0m7 7v4m0 0a3 3 0 100-6 3 3 0 000 6z" />
        </svg>
      </button>
    </div>

  </div>

  <script>
    // Globals
    let userName = localStorage.getItem("userName");
    let loading = true;
    let chatHistory = [];
    const brainstorm = {}; // The original Brainstorm.txt file was not found, so we will use an empty object instead.

    /***********************
     * UI Functions
     ***********************/
    function showMessage(message, from) {
      const chatHistoryDiv = document.getElementById('chatHistory');
      const messageDiv = document.createElement('div');
      messageDiv.textContent = message;
      messageDiv.classList.add('chat-bubble');

      if (from === 'user') {
        messageDiv.classList.add('chat-user');
      } else {
        messageDiv.classList.add('chat-bot');
      }
      
      chatHistoryDiv.appendChild(messageDiv);
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
    }

    function setUserName(name) {
      if (!name) return;
      userName = name;
      localStorage.setItem("userName", userName);
      document.getElementById("userName").textContent = userName;
      document.getElementById("userName").style.display = "block";
      document.getElementById("changeName").style.display = "block";
    }

    /***********************
     * Chat Functions
     ***********************/
    async function sendMessage() {
      const messageBox = document.getElementById('messageBox');
      const text = messageBox.value.trim();
      if (!text) return;
      
      showMessage(text, 'user');
      messageBox.value = '';
      
      const reply = await getReply(text);
      if (reply) {
        showMessage(reply, 'bot');
        speak(reply);
      }
    }

    async function getReply(message) {
      // This is a placeholder for the AI's logic.
      // The original code tried to use a local file for this, which was not found.
      // In a real application, you would connect to a language model API here.
      if (message.toLowerCase().includes("hello")) {
        return "Hello there! How can I help you today?";
      } else if (message.toLowerCase().includes("how are you")) {
        return "I'm doing great, thank you for asking!";
      } else {
        return "I'm sorry, I don't have a response for that. I am a simple AI for now.";
      }
    }

    /***********************
     * TTS & STT Functions
     ***********************/
    function speak(text) {
      try {
        const Speech = window.SpeechSynthesisUtterance;
        if (!Speech) {
          console.error("Speech synthesis not supported in this browser.");
          return;
        }
        const utterance = new Speech(text);
        utterance.lang = "en-US";
        window.speechSynthesis.speak(utterance);
      } catch (e) {
        console.error("Speech synthesis failed:", e);
      }
    }

    function startMic() {
      try {
        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Recognition) {
          speak("Sorry, speech recognition isn't supported in your browser.");
          return;
        }
        const recognition = new Recognition();
        recognition.lang = "en-US";
        recognition.start();
        
        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById('messageBox').value = transcript;
          sendMessage();
        };

        recognition.onerror = function(event) {
          console.error("Speech recognition error:", event.error);
        };

      } catch (e) {
        speak("Microphone access failed.");
        console.error("Error starting microphone:", e);
      }
    }

    /***********************
     * Event Listeners & Initialization
     ***********************/
    document.getElementById('sendBtn').addEventListener('click', sendMessage);
    document.getElementById('micBtn').addEventListener('click', startMic);
    document.getElementById('messageBox').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    document.getElementById('changeName').addEventListener('click', () => {
      const newName = prompt("Enter your new name:");
      setUserName(newName);
    });

    // Initial setup on page load
    window.onload = function() {
      // If a username exists in local storage, use it. Otherwise, prompt the user.
      if (!userName) {
        const initialName = prompt("Welcome! What is your name?");
        setUserName(initialName);
      }

      // Hide loading screen after everything is ready
      const loadingScreen = document.getElementById('loadingScreen');
      setTimeout(() => {
        loadingScreen.style.opacity = "0";
        setTimeout(() => loadingScreen.style.display = "none", 1000);
      }, 1000);
    };

    // Prevent the user from being prompted for a name on every refresh
    document.getElementById("userName").textContent = userName || "User";
    document.getElementById("changeName").style.display = userName ? "block" : "none";
  </script>

</body>
</html>
